# 치킨맵(ChickenMap) UI/기능 명세 — 요구사항 리팩토링 버전
작성일: 2026-02-26 (KST)

> 목적: **체인점 치킨 평점 앱**  
> - 사용자는 “내가 먹은 지점의 특정 치킨 메뉴”에 대해 평점을 남긴다.  
> - 앱은 두 축으로 보여준다:
>   1) **브랜드-메뉴(치킨 종류) 랭킹 리스트**: 예) `BBQ 후라이드 4.5`, `교촌 레드콤보 4.4`  
>   2) **지점(매장) 전체 평점 지도**: 예) `A지점 총점 4.5` (치킨 종류 표시는 하지 않음)

---

## 0) 핵심 개념 정리(가장 중요)

### 0.1 사용자가 실제로 평가하는 “원본” 대상
- **리뷰 원본 대상 = (지점, 브랜드, 메뉴)**  
  예: `BBQ 신내동점 / 후라이드`

사용자가 먹은 건 “지점의 특정 메뉴”이므로, 리뷰 원본은 이 단위로 저장하는 게 정확합니다.

### 0.2 앱에서 보여주는 집계(2종)
1) **브랜드-메뉴 집계(랭킹용)**
- 예: `BBQ 후라이드`, `교촌 레드콤보` 등 “치킨 종류”별 순위

2) **지점 집계(지도용)**
- 예: `BBQ 신내동점`, `BHC 신내동점` 등 “지점 자체” 총점
- 지도에서는 **치킨 종류를 노출하지 않음** (지점의 종합 평점만)

> 결론: 리뷰 1건은 “지점-메뉴”에 저장되지만, 집계는 **(브랜드-메뉴)** 와 **(지점 전체)** 로 동시에 반영됩니다.

---

## 1) 평점 항목(고정)

리뷰 입력 항목(8개, 1~5점):
- 바삭함
- 육즙
- 염도
- 기름상태
- 닭품질
- 튀김완성도
- 양
- 총 별점(Overall)

---

## 2) 데이터/집계 규칙(리팩토링 핵심)

### 2.1 테이블/키(개념)
- Brand(브랜드)
- Store(지점) — 좌표(lat/lng) 포함
- Menu(메뉴) — 예: 후라이드, 레드콤보, etc.
- Review(원본) — 사용자가 남긴 평가
- AggBrandMenu(브랜드-메뉴 집계) — 랭킹 화면용
- AggStore(지점 집계) — 지도 화면용 (치킨 종류 무관)

### 2.2 Review(원본) 저장 키(필수)
- `brand_id`
- `store_id`
- `menu_id`

그리고 8개 점수 + 메타(텍스트/사진/주문유형/시간 등)

### 2.3 집계 1) 브랜드-메뉴 랭킹 집계
- 그룹키: `(brand_id, menu_id)`
- 계산: 각 항목 평균 + overall 평균 + 리뷰 수

즉:
- `BBQ + 후라이드`의 평균 총점이 `BBQ 후라이드 4.5`로 노출됨

### 2.4 집계 2) 지점 “전체” 평점 집계(지도용)
- 그룹키: `(store_id)` **단독**
- 계산 방법(권장 2안 중 택1)

#### A안(간단): 리뷰의 overall만으로 지점 평균
- 어떤 메뉴든, 그 지점에서 작성된 모든 리뷰의 overall 평균 = 지점 총점

장점: 구현 단순, 직관적  
단점: 인기 메뉴 편향 가능(그래도 MVP엔 충분)

#### B안(조금 더 공정): 메뉴별 평균을 먼저 구한 뒤 메뉴 단위로 균형화
- store_id 기준으로 menu_id별 평균을 구하고, 메뉴별 평균들을 다시 평균(또는 가중)  
- 메뉴가 많은 지점에서 특정 메뉴 리뷰가 압도적으로 많아도, 지점 평점이 한 메뉴에 쏠리지 않게 보정 가능

MVP는 **A안으로 시작**하고, 데이터 쌓이면 B안으로 고도화 추천.

### 2.5 “리뷰 1건”이 반영되는 곳(정리)
사용자가 `BBQ 신내동점 / 후라이드` 리뷰 작성 시:

- **브랜드-메뉴 랭킹**: `BBQ 후라이드` 집계에 반영
- **지점 지도 평점**: `BBQ 신내동점` 집계에 반영(메뉴 종류는 지도에서 숨김)

---

## 3) 화면/페이지 설계 (MVP 최소 6~7개)

앱은 크게 2개의 “탐색 화면”이 핵심입니다.

### 3.1 탭 구조(권장)
- 탭1: **랭킹(브랜드-메뉴)**
- 탭2: **지도(지점 평점)**
- 탭3: **내 활동(내 리뷰/북마크/설정)**

### 3.2 페이지 목록(권장 7개)
1. 랭킹 홈(브랜드-메뉴 별점 리스트) ✅ (요구사항 1)
2. 랭킹 상세(브랜드-메뉴 상세: 분포/항목별 평균/리뷰)
3. 지도 홈(지점 평점 지도) ✅ (요구사항 2)
4. 지점 상세(지점 종합 평점 + 리뷰 요약/리뷰 리스트)
5. 리뷰 작성(지점+브랜드+메뉴 입력 대상으로 평점 입력)
6. 내 활동(내 리뷰 리스트/수정)
7. 설정/정책(권한/개인정보/신고)

---

## 4) 핵심 화면 UI 상세 명세

### 4.1 (1) 랭킹 홈: “브랜드-메뉴 별점 리스트”
목적:
- 사용자에게 “치킨 종류” 기준 TOP을 보여줌
- 예: `BBQ 후라이드 4.5`, `교촌 레드콤보 4.4`

UI 구성:
- 상단: 검색(브랜드/메뉴명), 필터(후라이드/양념/순살 등 카테고리 선택은 옵션)
- 정렬 옵션:
  - 기본: **보정 점수(또는 review_count 고려)** 기준
  - 대안: 평균 점수순, 리뷰수순, 최근 핫순(옵션)
- 리스트 아이템(카드):
  - `브랜드 로고 + 브랜드명`
  - `메뉴명`
  - `총점(별점) + 리뷰수`
  - (선택) 항목 하이라이트 2개(예: 바삭함 4.7, 기름상태 4.6)

탭/클릭 동작:
- 아이템 탭 → **랭킹 상세(브랜드-메뉴 상세)**

---

### 4.2 랭킹 상세: “브랜드-메뉴 상세”
목적:
- `BBQ 후라이드`의 전체 평균/분포/항목별 강약점/리뷰 확인

UI 구성:
- 헤더: `브랜드명 + 메뉴명`
- 큰 총점 + 리뷰수
- 평점 분포(1~5) 미니 차트
- 항목별 평균 7개(바/레이더 중 택1)
- 리뷰 리스트
- CTA:
  - `이 치킨 먹은 지점 선택하고 리뷰 남기기` → 지도/지점 검색으로 연결(brand+menu 프리필)

---

### 4.3 (2) 지도 홈: “지점별 평점 지도(치킨 종류 노출 X)”
목적:
- 사용자가 주변에서 “어느 지점이 전체적으로 괜찮은지”를 한눈에 봄

UI 구성(네이버맵 스타일):
- 상단: 검색(지점명/브랜드명/지역명)
- 지도: 지점 마커
  - **마커에는 지점 총점(예: 4.5)만 표시**
  - 치킨 종류 표시는 하지 않음
- 하단: 드래그 바텀시트(3단)
  - Peek: “이 주변 n개 지점”
  - Half: 선택 지점 카드(가로 스와이프)
  - Full: 지점 카드 리스트(정렬: 평점/거리/리뷰수)

마커 탭:
- 바텀시트에 해당 지점 카드 노출
- 카드 탭 → 지점 상세 이동

---

### 4.4 지점 상세: “지점 종합 평점”
목적:
- `A지점 총점 4.5`의 근거를 보여줌 (치킨 종류별로 쪼개진 상세는 옵션)

UI 구성:
- 헤더: `브랜드명 + 지점명 + 주소`
- 큰 총점 + 리뷰수 + 최근 리뷰일
- 항목별 평균(7개) + overall
- (선택) “메뉴별 대표 점수” 섹션(접힘/펼침):
  - 후라이드 4.6 / 레드콤보 4.2 … (있으면 유용하지만 MVP 옵션)
- 리뷰 리스트
- CTA:
  - `이 지점에서 먹은 치킨 리뷰 남기기`

---

### 4.5 리뷰 작성: “지점+치킨 메뉴 평점 입력”
목적:
- 사용자가 실제로 먹은 치킨을 기록

필수 입력:
- 지점 선택(지도/검색 기반)
- 브랜드 자동 선택(지점에 종속)
- 메뉴 선택(후라이드/레드콤보 등)
- 8개 점수 입력

UI 구성:
- 상단 대상 고정:
  - `지점명`
  - `브랜드명`
  - `메뉴명`
- 점수 입력 8개(별점/슬라이더)
- (선택) 텍스트/사진/주문유형

저장 시 처리:
- Review 저장(store_id, brand_id, menu_id)
- AggBrandMenu 갱신
- AggStore 갱신

---

## 5) 화면 흐름(유저 동선)

### 동선 A: 랭킹에서 시작
랭킹 홈 → 랭킹 상세 → (지점 선택 유도) 지도 홈(brand+menu 필터 적용) → 지점 상세 → 리뷰 작성

### 동선 B: 지도에서 시작
지도 홈 → 지점 상세 → 리뷰 작성  
(리뷰 작성에서 메뉴 선택)

---

## 6) DB/집계 SQL 예시(간단)

### 6.1 브랜드-메뉴 집계
```sql
SELECT
  brand_id,
  menu_id,
  AVG(crispy)  AS crispy_avg,
  AVG(juicy)   AS juicy_avg,
  AVG(salty)   AS salty_avg,
  AVG(oil)     AS oil_avg,
  AVG(chicken_quality) AS chicken_quality_avg,
  AVG(fry_quality)     AS fry_quality_avg,
  AVG(portion) AS portion_avg,
  AVG(overall) AS overall_avg,
  COUNT(*)     AS review_count
FROM review
WHERE deleted_at IS NULL
GROUP BY brand_id, menu_id;
```

### 6.2 지점 종합 집계(A안: 단순)
```sql
SELECT
  store_id,
  AVG(crispy)  AS crispy_avg,
  AVG(juicy)   AS juicy_avg,
  AVG(salty)   AS salty_avg,
  AVG(oil)     AS oil_avg,
  AVG(chicken_quality) AS chicken_quality_avg,
  AVG(fry_quality)     AS fry_quality_avg,
  AVG(portion) AS portion_avg,
  AVG(overall) AS overall_avg,
  COUNT(*)     AS review_count
FROM review
WHERE deleted_at IS NULL
GROUP BY store_id;
```

---

## 7) 다른 LLM에게 전달할 “지시문(프롬프트)” 템플릿

```text
모바일 앱 ‘치킨맵’ UI/기능 명세를 작성해줘.

[핵심 요구사항]
- 유저는 ‘자기가 먹은 지점의 특정 치킨 메뉴’에 대해 평점을 남긴다.
- 앱은 2개의 핵심 화면을 가진다.
  1) 브랜드-메뉴 랭킹 리스트: 예) BBQ 후라이드 4.5, 교촌 레드콤보 4.4 처럼 치킨 종류(메뉴) 단위 순위
  2) 지도 화면: 지점별 종합 평점 지도. 마커/카드에는 “지점 총점”만 보여주고 치킨 종류는 보여주지 않는다.

[평점 항목(8개, 1~5점)]
- 바삭함, 육즙, 염도, 기름상태, 닭품질, 튀김완성도, 양, 총 별점

[데이터/집계 규칙]
- 리뷰 원본은 (store_id, brand_id, menu_id) 기준으로 저장한다.
- 동일 리뷰 1건은 아래 집계에 동시에 반영되어야 한다.
  - 브랜드-메뉴 집계: GROUP BY (brand_id, menu_id)  → 랭킹 화면에 표시
  - 지점 종합 집계: GROUP BY (store_id)              → 지도 마커/지점 카드에 표시

[지도 UX]
- 네이버맵 같은 UX: 지도 + 하단 드래그 바텀시트(3단 Peek/Half/Full)
- 마커에는 지점 총점 배지(예: 4.5) 표시
- 클러스터링 지원

[산출물]
- 페이지 수/목록(MVP)
- 페이지별 UI 구성요소 상세
- 화면 흐름(유저 동선)
- 공통 컴포넌트(평점배지, 리뷰카드, 지점카드, 랭킹아이템)
- 데이터 모델 요약 및 집계 방법(A안/B안) 제시
```

---

## 8) 변경점 요약(이전 문서 대비)
- “지도 = 지점-메뉴”가 아니라 **지도는 지점 종합 평점(치킨 종류 표시 X)** 으로 변경
- “랭킹 = 브랜드”가 아니라 **랭킹은 브랜드-메뉴(치킨 종류) 단위**로 명확화
- 리뷰 원본은 여전히 “지점에서 먹은 메뉴” 기준으로 저장하되, 집계를 2개 축으로 분리:
  - (brand, menu) 랭킹
  - (store) 지도
